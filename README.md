# SAM2 Video Tracking Service

This repository provides a small service that exposes a Segment Anything 2 (SAM2)â€“based video tracking endpoint over HTTP.  
It is implemented using FastAPI and started via `uvicorn` using the provided shell script.

The main use case is to send a video file to the service and receive a ZIP archive of per-frame mask images generated by SAM2.

---

## Contents

- [Prerequisites](#prerequisites)
- [Installation](#installation)
- [Environment and configuration](#environment-and-configuration)
- [Starting the server](#starting-the-server)
- [API overview](#api-overview)
  - [Health check](#health-check)
  - [Video tracking endpoint](#video-tracking-endpoint)
- [Examples](#examples)
  - [Call the API with `wget` and a local file](#call-the-api-with-wget-and-a-local-file)
  - [Call the API from Python](#call-the-api-from-python)
- [Notes and troubleshooting](#notes-and-troubleshooting)

---

## Prerequisites

- Linux or macOS
- Python 3.11 or 3.12 (matching what you use in the virtual environment)
- Git
- Sufficient GPU/CPU resources to load and run the SAM2 model
- `ffmpeg` installed and available on `PATH` (if your pipeline requires it)

---

## Installation

Clone the repository and create a virtual environment in the project root:

```bash
git clone <your-sam2-tracker-repo-url> sam_tracker
cd sam_tracker

python3 -m venv .venv
source .venv/bin/activate

pip install --upgrade pip
```

## Examples

Call the API with wget and a local file

The simplest way to use wget is to send the raw binary data of the video as the request body with content type application/octet-stream.
This requires your endpoint to be defined to accept raw bytes in the request body.

Example (assuming /track accepts raw video bytes):
```bash
VIDEO_FILE="sample.mp4"
OUTPUT_ZIP="masks.zip"

wget \
  --method=POST \
  --header="Content-Type: application/octet-stream" \
  --body-file="$VIDEO_FILE" \
  -O "$OUTPUT_ZIP" \
  "http://localhost:8000/track"
```

To use curl instead of wget, for example:
```bash
curl -L \
  -o masks.zip \
  -X POST \
  -F "video=@/path/to/input.mp4" \
  "http://localhost:8000/track?frame_idx=80&points=1618,1010&points=1657,1012&points=1580,999"
  ```

For python clients:

```python
import requests

url = "http://localhost:8000/track"
params = [
    ("frame_idx", 80),
    ("points", "1618,1010"),
    ("points", "1657,1012"),
    ("points", "1580,999"),
]

with open("/path/to/input.mp4", "rb") as f:
    files = {"video": ("input.mp4", f, "video/mp4")}
    r = requests.post(url, params=params, files=files, timeout=600)
    r.raise_for_status()

with open("masks.zip", "wb") as out:
    out.write(r.content)

print("Saved masks.zip")
```