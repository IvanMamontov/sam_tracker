# SAM2 Video Tracking Service

This repository provides a small service that exposes a Segment Anything 2 (SAM2)â€“based video tracking endpoint over HTTP.  
It is implemented using FastAPI and started via `uvicorn` using the provided shell script.

The main use case is to send a video file to the service and receive a ZIP archive of per-frame mask images generated by SAM2.

---

## Contents

- [Prerequisites](#prerequisites)
- [Installation](#installation)
- [Environment and configuration](#environment-and-configuration)
- [Starting the server](#starting-the-server)
- [API overview](#api-overview)
  - [Health check](#health-check)
  - [Video tracking endpoint](#video-tracking-endpoint)
- [Examples](#examples)
  - [Call the API with `wget` and a local file](#call-the-api-with-wget-and-a-local-file)
  - [Call the API from Python](#call-the-api-from-python)
- [Notes and troubleshooting](#notes-and-troubleshooting)

---

## Prerequisites

- Linux or macOS
- Python 3.11 or 3.12 (matching what you use in the virtual environment)
- Git
- Sufficient GPU/CPU resources to load and run the SAM2 model
- `ffmpeg` installed and available on `PATH` (if your pipeline requires it)

---

## Installation

Clone the repository and create a virtual environment in the project root:

```bash
git clone <your-sam2-tracker-repo-url> sam_tracker
cd sam_tracker

python3 -m venv .venv
source .venv/bin/activate

pip install --upgrade pip
```

## Examples

Call the API with wget and a local file

The simplest way to use wget is to send the raw binary data of the video as the request body with content type application/octet-stream.
This requires your endpoint to be defined to accept raw bytes in the request body.

Example (assuming /track accepts raw video bytes):
```bash
VIDEO_FILE="sample.mp4"
OUTPUT_ZIP="masks.zip"

wget \
  --method=POST \
  --header="Content-Type: application/octet-stream" \
  --body-file="$VIDEO_FILE" \
  -O "$OUTPUT_ZIP" \
  "http://localhost:8000/track"
```

To use curl instead of wget, for example:
```bash
curl -X POST \
  -F "video=@sample.mp4" \
  -o masks.zip \
  http://localhost:8000/track
  ```

For python clients:

```python
import requests

url = "http://localhost:8000/track"
video_path = "sample.mp4"
output_zip = "masks.zip"

with open(video_path, "rb") as f:
    response = requests.post(
        url,
        data=f,
        headers={"Content-Type": "application/octet-stream"},
        timeout=600,
    )

response.raise_for_status()

with open(output_zip, "wb") as out:
    out.write(response.content)

print(f"Saved masks ZIP to {output_zip}")
```